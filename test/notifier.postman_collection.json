{
	"info": {
		"name": "notifier",
		"_postman_id": "e73ea611-0e96-d341-9a0e-b6617b1aa1fa",
		"description": "",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "login",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"var jsonData = JSON.parse(responseBody);",
							"tests[\"token found\"] = jsonData.data.token;",
							"postman.setEnvironmentVariable(\"token\", jsonData.data.token);",
							""
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Cookie",
						"value": "token={{token}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"username\":\"{{auth_user}}\",\n  \"password\":\"{{auth_passwd}}\"\n}"
				},
				"url": {
					"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/login",
					"protocol": "http",
					"host": [
						"{{auth_api_host}}"
					],
					"port": "{{auth_api_port}}",
					"path": [
						"auth",
						"login"
					]
				},
				"description": ""
			},
			"response": []
		},
		{
			"name": "add article 2",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"var jsonData = JSON.parse(responseBody);",
							"jsonData = jsonData.data||jsonData;",
							"tests[\"uuid found\"] = jsonData.uuid;",
							"postman.setEnvironmentVariable(\"article_2_id\", jsonData.uuid);"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"token\":\"{{token}}\",\n    \"title\": \"煤气费\",\n    \"it_service\": [\"{{service_dns_id}}\"],\n    \"tag\": [\"测试\",\"随机\"],\n  \"author\": \"{{auth_user_id}}\",\n  \"ref_links\": [\"https://www.baidu.com\"],\n  \"tasks\": \"测试插入\",\n  \"type\":\"Troubleshooting\",\n  \"content\":{\"description\": \"煤气费\", \"analysis\": \"煤气费\", \"solution\":\"前几天，我的邻居小伙伴突然在QQ上问我突然在不，她比我大几岁，平日里交集不算太多，这么冷不丁的来一句“在吗？”，让我误以为是骗子又来实施诈骗了\",\"workaround\": \"煤气费\"},\n  \"attachment\":[{\"href\":\"http://locahost/hello.txt\",\"size\":100,\"name\":\"hello\"},{\"href\":\"http://locahost/test.txt\",\"size\":100,\"name\":\"test\"}]\n }\n\n"
				},
				"url": {
					"raw": "http://{{kb_api_host}}:{{kb_api_port}}/KB/API/v1/articles",
					"protocol": "http",
					"host": [
						"{{kb_api_host}}"
					],
					"port": "{{kb_api_port}}",
					"path": [
						"KB",
						"API",
						"v1",
						"articles"
					]
				},
				"description": ""
			},
			"response": []
		},
		{
			"name": "search by article_id",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"var jsonData = JSON.parse(responseBody);",
							"jsonData = jsonData.data||jsonData;",
							"tests[\"article timeline found\"] = (jsonData.rows.length >= 1)"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "\n{\n  \"token\":\"{{token}}\",\n  \"filter\":\n  {\n    \"$or\": [{\"new.uuid\": \"{{article_2_id}}\"},{\"old.uuid\": \"{{article_2_id}}\"}]\n    \n  },\n  \"page\":1,\n  \"per_page\":3\n}\n"
				},
				"url": {
					"raw": "http://{{notifier_api_host}}:{{notifier_api_port}}/api/notifications/search",
					"protocol": "http",
					"host": [
						"{{notifier_api_host}}"
					],
					"port": "{{notifier_api_port}}",
					"path": [
						"api",
						"notifications",
						"search"
					]
				},
				"description": ""
			},
			"response": []
		},
		{
			"name": "search by source and type",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"var jsonData = JSON.parse(responseBody);",
							"jsonData = jsonData.data||jsonData;",
							"tests[\"data found\"] = (jsonData.rows.length >= 1)"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "\n{\n  \"token\":\"{{token}}\",\n  \"filter\":\n  {\n    \"type\":\"Article\",\n    \"source\":\"kb\"\n  },\n   \"page\":1,\n  \"per_page\":10\n}\n"
				},
				"url": {
					"raw": "http://{{notifier_api_host}}:{{notifier_api_port}}/api/notifications/search",
					"protocol": "http",
					"host": [
						"{{notifier_api_host}}"
					],
					"port": "{{notifier_api_port}}",
					"path": [
						"api",
						"notifications",
						"search"
					]
				},
				"description": ""
			},
			"response": []
		},
		{
			"name": "search unread",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "e033ba17-c2f7-42f6-972f-f147decddcdd",
						"type": "text/javascript",
						"exec": [
							"var jsonData = JSON.parse(responseBody);",
							"jsonData = jsonData.data||jsonData;",
							"tests[\"notification found\"] = (jsonData.rows.length >= 1)",
							"postman.setEnvironmentVariable(\"notification_id\", jsonData.rows[0].uuid);",
							"postman.setEnvironmentVariable(\"notification_unread_count\", jsonData.count);"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "\n{\n  \"token\":\"{{token}}\",\n  \"read\":false,\n  \"filter\":\n  {\n  },\n   \"page\":1,\n  \"per_page\":10\n}\n"
				},
				"url": {
					"raw": "http://{{notifier_api_host}}:{{notifier_api_port}}/api/notifications/search",
					"protocol": "http",
					"host": [
						"{{notifier_api_host}}"
					],
					"port": "{{notifier_api_port}}",
					"path": [
						"api",
						"notifications",
						"search"
					]
				},
				"description": ""
			},
			"response": []
		},
		{
			"name": "update status to read by uuid",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"tests[\"update timeline status\"] = responseCode.code == 200;"
						]
					}
				}
			],
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "\n{\n  \"token\":\"{{token}}\",\n  \"read\":true\n}\n"
				},
				"url": {
					"raw": "http://{{notifier_api_host}}:{{notifier_api_port}}/api/notifications/{{notification_id}}",
					"protocol": "http",
					"host": [
						"{{notifier_api_host}}"
					],
					"port": "{{notifier_api_port}}",
					"path": [
						"api",
						"notifications",
						"{{notification_id}}"
					]
				},
				"description": ""
			},
			"response": []
		},
		{
			"name": "unread count=count-- after update status",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "e3c3d9cf-fff8-4bcf-8330-e64c4e3a495f",
						"type": "text/javascript",
						"exec": [
							"var jsonData = JSON.parse(responseBody);",
							"jsonData = jsonData.data||jsonData;",
							"tests[\"notification found\"] = (jsonData.count == environment[\"notification_unread_count\"]-1)",
							""
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "\n{\n  \"token\":\"{{token}}\",\n  \"read\":false,\n  \"filter\":\n  {\n  },\n   \"page\":1,\n  \"per_page\":2\n}\n"
				},
				"url": {
					"raw": "http://{{notifier_api_host}}:{{notifier_api_port}}/api/notifications/search",
					"protocol": "http",
					"host": [
						"{{notifier_api_host}}"
					],
					"port": "{{notifier_api_port}}",
					"path": [
						"api",
						"notifications",
						"search"
					]
				},
				"description": ""
			},
			"response": []
		},
		{
			"name": "batch update status to read",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"tests[\"update timeline status\"] = responseCode.code == 200;"
						]
					}
				}
			],
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "\n{\n  \"token\":\"{{token}}\",\n  \"read\":true\n}\n"
				},
				"url": {
					"raw": "http://{{notifier_api_host}}:{{notifier_api_port}}/api/notifications/",
					"protocol": "http",
					"host": [
						"{{notifier_api_host}}"
					],
					"port": "{{notifier_api_port}}",
					"path": [
						"api",
						"notifications",
						""
					]
				},
				"description": ""
			},
			"response": []
		},
		{
			"name": "add notification",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "d724a5be-d1dc-41cc-8ce6-919d78ccdb94",
						"type": "text/javascript",
						"exec": [
							"var jsonData = JSON.parse(responseBody);",
							"jsonData = jsonData.data||jsonData;",
							"tests[\"uuid found\"] = jsonData.uuid;",
							"if(jsonData.uuid){",
							"   postman.setEnvironmentVariable(\"notification_id\", jsonData.uuid); ",
							"}",
							""
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "token",
						"value": "{{token}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "\n{\n  \"action\":\"create\",\n  \"new\":{\"subscriber\":\"{{auth_user_id}}\",\"occurrence_date\":1511936480773},\n  \"type\":\"Order\",\n  \"source\":\"api\",\n  \"additional\":{\"a\":1,\"b\":true}\n}\n"
				},
				"url": {
					"raw": "http://{{notifier_api_host}}:{{notifier_api_port}}/api/notifications",
					"protocol": "http",
					"host": [
						"{{notifier_api_host}}"
					],
					"port": "{{notifier_api_port}}",
					"path": [
						"api",
						"notifications"
					]
				},
				"description": ""
			},
			"response": []
		},
		{
			"name": "search by additional",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"var jsonData = JSON.parse(responseBody);",
							"jsonData = jsonData.data||jsonData;",
							"tests[\"data found\"] = (jsonData.rows.length >= 1)"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "token",
						"value": "{{token}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "\n{\n  \"filter\":\n  {\n    \"additional.a\": 1\n  },\n   \"page\":1,\n  \"per_page\":10\n}\n"
				},
				"url": {
					"raw": "http://{{notifier_api_host}}:{{notifier_api_port}}/api/notifications/search",
					"protocol": "http",
					"host": [
						"{{notifier_api_host}}"
					],
					"port": "{{notifier_api_port}}",
					"path": [
						"api",
						"notifications",
						"search"
					]
				},
				"description": ""
			},
			"response": []
		}
	]
}